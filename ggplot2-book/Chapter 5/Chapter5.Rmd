---
title: "Chapter5 - Statistical summaries"
output: html_notebook
---

```{r}
library(ggplot2)
```


# 5.1 Revealing uncertainty

```{r}
y <- c(18, 11, 16)
df <- data.frame(x = 1:3, y = y, se = c(1.2, 0.5, 1.0))

base <- ggplot(df, aes(x, y, ymin = y - se, ymax = y + se))
base + geom_crossbar()
base + geom_pointrange()
base + geom_smooth(stat = "identity")

base + geom_errorbar()
base + geom_linerange()
base + geom_ribbon()
```

# 5.2 Weighted data
```{r}
# Unweighted
ggplot(midwest, aes(percwhite, percbelowpoverty)) + 
  geom_point()

# Weight by population
ggplot(midwest, aes(percwhite, percbelowpoverty)) + 
  geom_point(aes(size = poptotal / 1e6)) + 
  scale_size_area("Population\n(millions)", breaks = c(0.5, 1, 2, 4))
```

```{r}
# Unweighted
ggplot(midwest, aes(percwhite, percbelowpoverty)) + 
  geom_point() + 
  geom_smooth(method = lm, size = 1)

# Weighted by population
ggplot(midwest, aes(percwhite, percbelowpoverty)) + 
  geom_point(aes(size = poptotal / 1e6)) + 
  geom_smooth(aes(weight = poptotal), method = lm, size = 1) +
  scale_size_area(guide = "none")

```



```{r}
ggplot(midwest, aes(percbelowpoverty)) +
  geom_histogram(binwidth = 1) + 
  ylab("Counties")

ggplot(midwest, aes(percbelowpoverty)) +
  geom_histogram(aes(weight = poptotal), binwidth = 1) +
  ylab("Population (1000s)")
```

# 5.3 Diamonds data

```{r}
diamonds
```


# 5.4 Displaying distributions

For 1d continuous distributions the most important geom is the histogram:
```{r}
ggplot(diamonds, aes(depth)) + 
  geom_histogram()


ggplot(diamonds, aes(depth)) + 
  geom_histogram(binwidth = 0.1) + 
  xlim(55, 70)
```


to compare the distribution between groups:
```{r}
ggplot(diamonds, aes(depth)) + 
  geom_freqpoly(aes(colour = cut), binwidth = 0.1, na.rm = TRUE) +
  xlim(58, 68) + 
  theme(legend.position = "none")
```

in this plot, you must pay attention on the heights of the bars:
```{r}
ggplot(diamonds, aes(depth)) + 
  geom_histogram(aes(fill = cut), binwidth = 0.1, position = "fill",
    na.rm = TRUE) +
  xlim(58, 68) + 
  theme(legend.position = "none")
```

the density is useful when you want to compare the shape of the distributions, not the overall size.




```{r}
ggplot(diamonds, aes(depth)) +
  geom_density(na.rm = TRUE) + 
  xlim(58, 68) + 
  theme(legend.position = "none")
ggplot(diamonds, aes(depth, fill = cut, colour = cut)) +
  geom_density(alpha = 0.2, na.rm = TRUE) + 
  xlim(58, 68) + 
  theme(legend.position = "none")
```



to compare may groups but in lower quality of information:
```{r}
ggplot(diamonds, aes(clarity, depth)) + 
  geom_boxplot()
ggplot(diamonds, aes(carat, depth)) + 
  geom_boxplot(aes(group = cut_width(carat, 0.1))) + 
  xlim(NA, 2.05)
```

```{r}
ggplot(diamonds, aes(clarity, depth)) + 
  geom_violin()
ggplot(diamonds, aes(carat, depth)) + 
  geom_violin(aes(group = cut_width(carat, 0.1))) + 
  xlim(NA, 2.05)
```

and also the `geom_dotplot()`.

## 5.4.1 Exercises

### question 1

```{r}
ggplot(diamonds, aes(carat)) +
  geom_freqpoly(binwidth = 0.05)
```

### question 2

```{r}
ggplot(diamonds, aes(price)) +
  geom_histogram(bins = 500)
```

### question 3
```{r}
ggplot(diamonds, aes(price, color = clarity)) +
  geom_freqpoly()

ggplot(diamonds, aes(clarity, price)) +
  geom_boxplot()
```

### question 4

```{r}
ggplot(diamonds, aes(price, ..density..)) +
  geom_density(na.rm = TRUE, color = "red") +
  geom_freqpoly(color = "blue")
```

# 5.5 Dealing with overplotting


* for small dataset:
```{r}
df <- data.frame(x = rnorm(2000), y = rnorm(2000))
norm <- ggplot(df, aes(x, y)) + xlab(NULL) + ylab(NULL)
norm + geom_point()
norm + geom_point(shape = 1) # Hollow circles
norm + geom_point(shape = ".") # Pixel sized
```



* for large dataset:
the denominator gives the number of points that must be overplotted to give a solid colour.
```{r}
norm + geom_point(alpha = 1 / 3)
norm + geom_point(alpha = 1 / 5)
norm + geom_point(alpha = 1 / 10)
```




```{r}
norm + geom_bin2d()
norm + geom_bin2d(bins = 10)
```
```{r}
norm + geom_hex()
norm + geom_hex(bins = 10)
```

Another approach to dealing with overplotting is to add data summaries to help guide the eye to the true shape of the pattern within the data.

# 5.6 Statistical summaries


 The first example in each pair shows how we can count the number of diamonds in each bin; the second shows how we can compute the average price.
 
```{r}
ggplot(diamonds, aes(color)) + 
  geom_bar()

ggplot(diamonds, aes(color, price)) + 
  geom_bar(stat = "summary_bin", fun = mean)
```

```{r}
ggplot(diamonds, aes(table, depth)) + 
  geom_bin2d(binwidth = 1, na.rm = TRUE) + 
  xlim(50, 70) + 
  ylim(50, 70)

ggplot(diamonds, aes(table, depth, z = price)) + 
  geom_raster(binwidth = 1, stat = "summary_2d", fun = mean, 
    na.rm = TRUE) + 
  xlim(50, 70) + 
  ylim(50, 70)
```

# 5.7 Surfaces

the `..` notation refers to a variable computed internally.
```{r}
ggplot(faithfuld, aes(eruptions, waiting)) + 
  geom_contour(aes(z = density, colour = ..level..))
```
hitmap
```{r}
ggplot(faithfuld, aes(eruptions, waiting)) + 
  geom_raster(aes(fill = density))
```

```{r}
# Bubble plots work better with fewer observations
small <- faithfuld[seq(1, nrow(faithfuld), by = 10), ]
ggplot(small, aes(eruptions, waiting)) + 
  geom_point(aes(size = density), alpha = 1/3) + 
  scale_size_area()
```

