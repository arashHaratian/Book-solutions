---
title: "Chapter10 - Position scales and axes"
output: html_notebook
---

# Introduction
## 9.4 Scale names

```{r}
toy <- data.frame(
  const = 1, 
  up = 1:4,
  txt = letters[1:4], 
  big = (1:4)*1000,
  log = c(2, 5, 10, 2000)
)
toy


base <- ggplot(toy, aes(up, up)) + geom_point()

base + scale_x_continuous("X axis")
base + scale_x_continuous(quote(a + mathematical ^ expression))
```

```{r}
base <- ggplot(toy, aes(up, up)) + 
  geom_point() + 
  scale_x_continuous("Axis title with *italics* and **boldface**")

base
base + theme(axis.title.x = ggtext::element_markdown())
```

```{r}
ggplot(toy, aes(const, up)) + 
  geom_point(aes(colour = txt)) + 
  labs(
    x = "X axis", 
    y = quote(Y^axis), 
    colour = "Colour\nlegend",
    title = "A pithy title",
    subtitle = "A more precise subtitle"
  )
```


# 10.1 Numeric
```{r}
ggplot(mpg, aes(x = displ)) + geom_histogram()
ggplot(mpg, aes(x = displ, y = after_stat(count))) + geom_histogram()
```

```{r}
base <- ggplot(mpg, aes(displ, hwy)) + geom_point()

base
base + scale_x_reverse()
base + scale_y_reverse()
```


## 10.1.2 Out of bounds values

By default, ggplot2 converts data outside the scale limits to NA. This means that changing the limits of a scale is not precisely the same as visually zooming in to a region of the plot. If your goal is to zoom in part of the plot, it is better to use the `xlim` and `ylim` arguments of `coord_cartesian()`:

```{r}
base <- ggplot(mpg, aes(drv, hwy)) + 
  geom_hline(yintercept = 28, colour = "red") + 
  geom_boxplot() 

base
base + coord_cartesian(ylim = c(10, 35)) # zoom only
base + ylim(10, 35) # alters the boxplot
```

```{r}
df <- data.frame(x = 1:6, y = 8:13)
base <- ggplot(df, aes(x, y)) + 
  geom_col(aes(fill = x)) +                    # bar chart
  geom_vline(xintercept = 3.5, colour = "red") # for visual clarity only

base
base + scale_fill_gradient(limits = c(1, 3))
base + scale_fill_gradient(limits = c(1, 3), oob = scales::squish)
```

## 10.1.3 Visual range expansion

```{r}
ggplot(faithfuld, aes(waiting, eruptions)) + 
  geom_raster(aes(fill = density)) + 
  theme(legend.position = "none")

ggplot(faithfuld, aes(waiting, eruptions)) + 
  geom_raster(aes(fill = density)) + 
  scale_x_continuous(expand = c(0,0)) + 
  scale_y_continuous(expand = c(0,0)) +
  theme(legend.position = "none")
```

## 10.1.4 Exercises

### question 1

```{r}
fwd <- subset(mpg, drv == "f")
rwd <- subset(mpg, drv == "r")

ggplot(fwd, aes(displ, hwy, colour = class)) + geom_point()
ggplot(rwd, aes(displ, hwy, colour = class)) + geom_point()

ggplot(mpg, aes(displ, hwy, colour = class)) + geom_point() + facet_wrap(~drv)
```

```{r}
ggplot(fwd, aes(displ, hwy, colour = class)) + geom_point() + scale_color_discrete(limits = mpg$class)
ggplot(rwd, aes(displ, hwy, colour = class)) + geom_point() + scale_color_discrete(limits = mpg$class)
```

```{r}
ggplot(fwd, aes(displ, hwy, colour = class)) + geom_point() + expand_limits(color = c("2seater", "compact", "midsize", "minivan", "pickup", "subcompact", "suv"))

ggplot(rwd, aes(displ, hwy, colour = class)) + geom_point() + expand_limits(color = c("2seater", "compact", "midsize", "minivan", "pickup", "subcompact", "suv"))
```

### question 2

```{r}
ggplot(mpg, aes(displ, hwy)) + geom_point() + xlim(2, 5) + xlim(2, 15)
```
 

### question 3
```{r}
ggplot(mpg, aes(displ, hwy)) + geom_point()
ggplot(mpg, aes(displ, hwy)) + geom_point() + scale_x_continuous(limits = c(NA, NA))
```
### question 4
```{r}
?expand_limits
expand_limits
```

## 10.1.5 Breaks

```{r}
toy <- data.frame(
  const = 1, 
  up = 1:4,
  txt = letters[1:4], 
  big = (1:4)*1000,
  log = c(2, 5, 10, 2000)
)
toy


axs <- ggplot(toy, aes(big, const)) + 
  geom_point() + 
  labs(x = NULL, y = NULL)
axs
axs + scale_x_continuous(breaks = scales::breaks_extended())
axs + scale_x_continuous(breaks = scales::breaks_extended(n = 2))
```


```{r}
axs + scale_x_continuous(breaks = scales::breaks_width(800))
axs + scale_x_continuous(breaks = scales::breaks_width(800, offset = 200))
axs + scale_x_continuous(breaks = scales::breaks_width(800, offset = -200))
```

```{r}
axs + scale_x_continuous(breaks = NULL)
```

```{r}
mb <- unique(as.numeric(1:10 %o% 10 ^ (0:3)))
mb
```

```{r}
log_base <- ggplot(toy, aes(log, const)) + geom_point()

log_base + scale_x_log10()
log_base + scale_x_log10(minor_breaks = mb)
```

## 10.1.7 Labels

```{r}
axs + scale_x_continuous(breaks = c(2000, 4000), labels = c("2k", "4k"))
```

```{r}
axs + scale_y_continuous(labels = scales::label_percent())
axs + scale_y_continuous(labels = scales::label_dollar(prefix = "", suffix = "â‚¬"))
```

```{r}
axs + scale_x_continuous(labels = NULL)
```

## 10.1.8 Exercises

### question 1
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  scale_x_continuous("Displacement",
    breaks = c(2,3,4,5,6,7),
    labels = paste0(2:7, "L")) +
  ylab(quote(Highway (Miles / Gallon)))
```

### question 3

```{r}
scales::math_format()
scales::ordinal_format()
```

# 10.2 Date-time
## 10.2.1 Breaks

```{r}
date_base <- ggplot(economics, aes(date, psavert)) + 
  geom_line(na.rm = TRUE) +
  labs(x = NULL, y = NULL)

date_base 
date_base + scale_x_date(date_breaks = "25 years")
```


```{r}
century20 <- as.Date(c("1900-01-01", "1999-12-31"))
breaks <- scales::breaks_width("25 years")
breaks(century20)
```

## 10.2.2 Minor breaks

```{r}
date_base + scale_x_date(
  limits = as.Date(c("2003-01-01", "2003-04-01")),
  date_breaks = "1 month"
)

date_base + scale_x_date(
  limits = as.Date(c("2003-01-01", "2003-04-01")),
  date_breaks = "1 month",
  date_minor_breaks = "1 week"
)
```


## 10.2.4 Date scale labels
```{r}
base <- ggplot(economics, aes(date, psavert)) + 
  geom_line(na.rm = TRUE) +
  labs(x = NULL, y = NULL)

base + scale_x_date(date_breaks = "5 years")
base + scale_x_date(date_breaks = "5 years", date_labels = "%y")
```


```{r}
lim <- as.Date(c("2004-01-01", "2005-01-01"))

base + scale_x_date(limits = lim, date_labels = "%b %y")
base + scale_x_date(limits = lim, date_labels = "%B\n%Y")
```

```{r}
base + scale_x_date(labels = scales::label_date("%b %y"))
base + scale_x_date(limits = lim, labels = scales::label_date_short())
```

# 10.3 Discrete

```{r}
ggplot(mpg, aes(x = hwy, y = class)) + 
  geom_point()

ggplot(mpg, aes(x = hwy, y = class)) + 
  geom_point() + 
  scale_x_continuous() +
  scale_y_discrete()
```

```{r}
ggplot(mpg, aes(x = hwy, y = class)) + 
  geom_point() +
  annotate("text", x = 5, y = 1:7, label = 1:7)
```


## 10.3.2 Scale labels

```{r}
base <- ggplot(toy, aes(const, txt)) + 
  geom_point() +
  labs(x = NULL, y = NULL)

base
base + scale_y_discrete(labels = c(c = "carrot", b = "banana"))
```

## 10.3.3 guide_axis()

```{r}
base <- ggplot(mpg, aes(manufacturer, hwy)) + geom_boxplot() 

base + guides(x = guide_axis(n.dodge = 3))
base + guides(x = guide_axis(angle = 90))
```

# 10.4 Binned

```{r}
base <- ggplot(mpg, aes(hwy, class)) + geom_count()

base 
base + scale_x_binned(n.breaks = 10)
```


# 10.5 Limits

```{r}
df <- data.frame(x = 1:3, y = 1:3)
base <- ggplot(df, aes(x, y)) + geom_point() 

base
base + scale_x_continuous(limits = c(0, 4))
base + scale_x_continuous(limits = c(1.5, 2.5))
```

## 10.5.1 Setting multiple limits

```{r}
ggplot(mpg, aes(displ, hwy, colour = fl)) + 
  geom_point() +
  facet_wrap(vars(year))
```

```{r}
mpg_99 <- mpg %>% filter(year == 1999)
mpg_08 <- mpg %>% filter(year == 2008)

base_99 <- ggplot(mpg_99, aes(displ, hwy, colour = fl)) + geom_point() 
base_08 <- ggplot(mpg_08, aes(displ, hwy, colour = fl)) + geom_point() 

base_99
base_08
```


```{r}
base_99 + 
  scale_x_continuous(limits = c(1, 7)) +
  scale_y_continuous(limits = c(10, 45))

base_08 + 
  scale_x_continuous(limits = c(1, 7)) +
  scale_y_continuous(limits = c(10, 45))
```

```{r}
base_99 + 
  scale_x_continuous(limits = c(1, 7)) +
  scale_y_continuous(limits = c(10, 45)) +
  scale_color_discrete(limits = c("c", "d", "e", "p", "r"))

base_08 + 
  scale_x_continuous(limits = c(1, 7)) +
  scale_y_continuous(limits = c(10, 45)) +
  scale_color_discrete(limits = c("c", "d", "e", "p", "r"))
```

```{r}
base_99 + xlim(1, 7) + ylim(10, 45)
base_08 + xlim(1, 7) + ylim(10, 45)
```

```{r}
base_99 + lims(x = c(1, 7), y = c(10, 45), colour = c("c", "d", "e", "p", "r"))
base_08 + lims(x = c(1, 7), y = c(10, 45), colour = c("c", "d", "e", "p", "r"))
```

